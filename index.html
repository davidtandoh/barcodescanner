<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="davidstheme.css"/>
    <link rel="stylesheet" href="jquery.mobile.icons.min.css"/>
    <link rel="stylesheet" href="jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.css"/>
    <script src="jquery-2.1.4.min.js"></script>
    <script src="jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>
   
</head>
<body>
    <div data-role="page" id="pagetwo" data-theme="c">
        <div data-role="header">
            <a href="#pageone" data-role="button">Home</a>
            <a href="" data-role="button">Options</a>
            <h1>MeterREADER</h1>
            <div data-role="navbar">
            </div>
        </div>
        <div role="main" class = "ui-content">
            <form method="post">
                <div data-role="fieldcontain">
                    <input type="text" name="meterinfo" id="meterinfo">
                    <input type="submit" value="Scan" id="submitBtn">
                </div>
                <a href="#pageone"  data-role="button" data-icon="arrow-l" data-rel="back">Go Back</a>
            </form>
            
            
        </div>
        <div data-role="footer">
            <h1>Tanoe Concepts</h1>
        </div>
    </div>
    </div>
    
     <script type="text/javascript">
        
        $(function(){
         $("#submitBtn").click(function(){
            addRecord();
        });
            
        $("#loadBtn").click(function(){
            getRecords();
        });
        

        function sendRequest(u){
            // Send request to server
            //u a url as a string
            //async is type of request
            var obj=$.ajax({url:u,async:false});
            //Convert the JSON string to object
            var result=$.parseJSON(obj.responseText);
            return result;	//return object	
        }
        
        function addRecord(){
            var wl = $("#waterlevel").val();
            var mi = $("#meterinfo").val();
            var url = "recordcases.php?cmd=1&waterlevel="+wl+"&meterinfo="+mi+"";
            var obj = sendRequest(url);   
            if(obj.result == 1){
            }
            else{
            }
        }
            
        function getRecords(){
            var url = "recordcases.php?cmd=2";
            var obj = sendRequest(url);
            
            if(obj.result == 1){
                var output = "";
                
                for(var index in obj.waterlevel){
                    //output += "<li><a href = index.html>";
                    output += "<li><p>Water level: "+obj.waterlevel[index].waterlevel+"<p>Meter Information: "+obj.waterlevel[index].meterinfo+"</p>";
     
                }
                $("#recordlist").html(output);
            }
        }
            
        });
         
         
            cordova.plugins.barcodeScanner.scan(
      function (result) {
          alert("We got a barcode\n" +
                "Result: " + result.text + "\n" +
                "Format: " + result.format + "\n" +
                "Cancelled: " + result.cancelled);
      }, 
      function (error) {
          alert("Scanning failed: " + error);
      }
   );
         
          cordova.plugins.barcodeScanner.encode(cordova.plugins.barcodeScanner.Encode.TEXT_TYPE, "http://www.nytimes.com", function(success) {
            alert("encode success: " + success);
          }, function(fail) {
            alert("encoding failed: " + fail);
          }
        );
         
        
    </script>
</body>
</html>